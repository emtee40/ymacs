!function(){var BASE=DlGrid.inherits(DlContainer);function DlGrid(args){args&&(D.setDefaults(this,args),"string"==typeof this._rowType&&(this._rowType=eval(this._rowType)),this._rowType||(this._rowType=DlGridRow),"string"==typeof this._headType&&(this._headType=eval(this._headType)),this._headType||(this._headType=DlGridHeadLabel),DlContainer.call(this,args))}eval(Dynarch.EXPORT("DlGrid",!0));var MIN_COL_WID=20,SO=(D.DEFAULT_ARGS={_model:["model",null],_selType:["selType","row"],_rowType:["rowType",null],_headType:["headType",null]},DOM.setOuterSize),SI=DOM.setInnerSize,HTML=String.buffer("<div class='DlGrid-Headers'>","<table class='DlGrid-Table' cellspacing='0' cellpadding='0'>","<tbody><tr></tr></tbody></table></div>","<div class='DlGrid-Body'>","<table class='DlGrid-Table' cellspacing='0' cellpadding='0'>","<tbody></tbody></table></div>").get();function onBodyScroll(){this.getHeaderDiv().scrollLeft=this.getBodyDiv().scrollLeft}function startResize(e,t,i){i=i||window.event;var l=e.offsetLeft,s=DlResizeBar.getDragBar(),o=s.style,o=(o.left=l-this.getBodyDiv().scrollLeft+1+"px",o.height="100%",o.width=e.offsetWidth-2+"px",o.top="0px",this.getElement().appendChild(s),DlDialog.activateEventStopper(!0)),s=(DOM.addClass(o,"CURSOR-RESIZE-E"),DlEvent.captureGlobals(this._resizeCaptures),new DlEvent(i));this._resize={div:e,col:t,pos:l,orig:this.getActualColWidth(t.getIndex()),mouse:s.pos.x},DOM.stopEvent(i)}function doResize(e){var t=DlResizeBar.getDragBar(),e=this._resize.pos+e.pos.x-this._resize.mouse,i=e-this._resize.pos,i=this._resize.orig+i;i<MIN_COL_WID&&(e+=MIN_COL_WID-i),e-=this.getBodyDiv().scrollLeft,t.style.left=e+1+"px"}function stopResize(e){var e=this._resize.pos+e.pos.x-this._resize.mouse,e=e-this._resize.pos,t=this._resize.orig+e,t=(t<MIN_COL_WID&&(t=MIN_COL_WID),e=t-this._resize.orig,this.setColSize(this._resize.col,t),this._updateFillCols(e),this.getElement().removeChild(DlResizeBar.getDragBar()),DlEvent.releaseGlobals(this._resizeCaptures),DlDialog.activateEventStopper(!1));DOM.delClass(t,"CURSOR-RESIZE-E")}P._createElement=function(){BASE._createElement.call(this),this._rowsGroup=DlRadioGroup.get(),this.setContent(HTML),this.getBodyDiv().onscroll=onBodyScroll.$(this),this._initHeaders(),this._initBody()},P.getGroup=function(){return this._rowsGroup},P.getHeaderDiv=function(){return this.getElement().firstChild},P.getHandlesDiv=function(){var e=this.getHeaderDiv().childNodes[1];return e||(e=CE("div",null,{className:"DlGrid-Handles"},this.getHeaderDiv()),this._resizeCaptures={onMouseMove:doResize.$(this),onMouseUp:stopResize.$(this),onMouseOver:DlException.stopEventBubbling,onMouseOut:DlException.stopEventBubbling,onMouseEnter:DlException.stopEventBubbling,onMouseLeave:DlException.stopEventBubbling}),e},P.getHeaderRow=function(){return this.getHeaderDiv().firstChild.rows[0]},P.getBodyDiv=function(){return this.getElement().childNodes[1]},P.getBodyTable=function(){return this.getBodyDiv().firstChild},P._onHeadClick=function(){},P._appendWidgetElement=function(e,t){var i;e instanceof this._rowType?(i=this.getBodyTable(),null!=t&&(t=i.rows[t])?t.parentNode.insertBefore(e.getElement(),t):i.firstChild.appendChild(e.getElement())):BASE._appendWidgetElement.apply(this,arguments)},P._initHeaders=function(){var i=this._onHeadClick.$(this);this._model.foreachCol(function(e){var t=document.createElement("td"),t=(this.getHeaderRow().appendChild(t),this._makeHeadLabel({parent:this,appendArgs:t,iconClass:e.getIconClass(),label:e.getLabel(),column:e,className:"DlGrid-align-"+e.getStyle("textAlign","left"),tooltip:e.tooltip}));(e._button=t).addEventListener("onClick",i)},this)},P._makeRow=function(e){return new this._rowType(e)},P._makeHeadLabel=function(e){return new this._headType(e)},P._initBody=function(){this._model.foreachRow(function(e){this._makeRow({parent:this,group:this._rowsGroup,value:e.id,model:e})},this),this._model.addEventListener({onInsertRow:this._insertRow.$(this),onDeleteRow:this._deleteRow.$(this),onSort:this._sort.$(this)})},P._insertRow=function(e){for(var t=e.getIndex(),i=(e=this._makeRow({parent:this,group:this._rowsGroup,value:e.id,model:e,appendArgs:t})).getElement().cells,l=this.getHeaderRow().cells,s=i.length;0<=--s;){var o=i[s],n=l[s].offsetWidth;SO(o.firstChild,n,null),SI(o,n,null)}},P._deleteRow=function(e){var t=e.getIndex();(e=this.getRowByIndex(t)).destroy()},P._sort=function(e,t,i,l){var s,o;t&&(t._button.delClass("DlGridHeadLabel-sort-up"),t._button.delClass("DlGridHeadLabel-sort-down")),e&&(e._button.condClass(i,"DlGridHeadLabel-sort-down","DlGridHeadLabel-sort-up"),t=this.getBodyTable(),s=t.firstChild,o=t.rows,(l=l.map(function(e){return o[e]})).foreach(function(e){s.appendChild(e)}))},P.__doLayout=function(){var e=this.getInnerSize(),t=this.getBodyDiv(),i=this.getHeaderDiv();SO(t,e.x,e.y-i.offsetHeight),SO(i,e.x,null),i.style.marginRight=-DOM.getScrollbarSize(t).x+"px",this.__hasLayout?this._updateFillCols():(this._initColSizes(),this.__hasLayout=!0,this.getBodyTable().style.width=""),onBodyScroll.call(this)},P.getRowByIndex=function(e){try{return DlWidget.getFromElement(this.getBodyTable().rows[e])}catch(e){}},P.getRowById=function(e){return this.getRowByIndex(this._model.getRowById(e).getIndex())},P.getActualColWidth=function(e){return this.getHeaderRow().cells[e].offsetWidth},P._initColSizes=function(){var i=this.getHeaderDiv().offsetHeight+"px",l=0,e=this.getInnerSize().x-DOM.getScrollbarSize(this.getBodyDiv()).x,s=(this._fillCols=[],this._model.foreachCol(function(e){e.fill?this._fillCols.push(e):l+=e.width||this.getActualColWidth(e.getIndex())},this),e-l);l=0,this._model.foreachCol(function(e){var t=e.fill?Math.floor(s*e.fill):e.width||this.getActualColWidth(e.getIndex()),t=this.setColSize(e,t,!0);l+=t,e.isResizable&&!e._resizeHandle&&(t=CE("div",{left:l+"px",height:i},{className:"DlGrid-resizeHandle"},this.getHandlesDiv()),is_ie&&DOM.setUnselectable(t,!0),((t.dl_resizeCol=e)._resizeHandle=t).onmousedown=startResize.$(this,t,e))},this)},P.setColSize=function(t,i,e){var l,s=t._button;null!=i&&(s.setOuterSize({x:i}),l=s.getElement().parentNode,SO(l,i,null)),this.getBodyTable().rows[0];return i=s.getOuterSize().x,t=t.getIndex(),Array.$(this.getBodyTable().rows).foreach(function(e){e&&(l=e.cells[t],SO(l.firstChild,i,null),SI(l,i,null))}),onBodyScroll.call(this),e||this._updateResizeHandles(),i},P._updateFillCols=function(i){var e;null==i&&(e=this.getBodyDiv(),i=this.getHeaderRow().offsetWidth-e.offsetWidth+DOM.getScrollbarSize(e).x),this._fillCols.foreach(function(e){var t=this.getActualColWidth(e.getIndex());t-=Math.round(e.fill*i),this.setColSize(e,t)},this)},P._updateResizeHandles=function(){this._model.foreachCol(function(e){var t;e._resizeHandle&&(t=e._button.getElement().parentNode,e._resizeHandle.style.left=t.offsetLeft+t.offsetWidth+"px")})},P._handle_focusKeys=function(e){var t,i=this.getGroup(),l=e.focusedWidget;switch(e.keyCode){case DlKeyboard.ARROW_UP:case DlKeyboard.ARROW_DOWN:case DlKeyboard.PAGE_UP:case DlKeyboard.PAGE_DOWN:(t=e.keyCode==DlKeyboard.ARROW_UP||e.keyCode==DlKeyboard.PAGE_UP?this.getPrevRow(l):this.getNextRow(l))?(t.focus(),e.shiftKey&&"multiple"==this._selType?(i.maxChecked(null),l.checked(!0),t.checked(!0)):"multiple"!=this._selType&&(i.maxChecked(1),t.checked(!0))):(e.shiftKey||e.ctrlKey)&&l.checked(!0),e.domStop=!0,DlException.stopEventBubbling();break;case DlKeyboard.HOME:case DlKeyboard.END:(t=e.keyCode==DlKeyboard.HOME?this.getRowByIndex(0):this.getRowByIndex(this.getBodyTable().rows.length-1))&&(t.focus(),e.domStop=!0,"multiple"!=this._selType&&(e.keyCode=DlKeyboard.ENTER,t._handle_focusKeys(e)),DlException.stopEventBubbling())}return BASE._handle_focusKeys.call(this,e)},P.getNextRow=function(e){return this.getRowByIndex(e.getModel().getIndex()+1)},P.getPrevRow=function(e){return this.getRowByIndex(e.getModel().getIndex()-1)}}(),!function(){var BASE=DlGridRow.inherits(DlAbstractButton);function DlGridRow(e){e&&(this._customMoveKeys=!0,D.setDefaults(this,e),DlAbstractButton.call(this,e))}function getTooltip(){return this.args.widget.getModel().tooltip}function onDestroy(){this._model.removeEventListener("onChange",this._on_modelChange)}function displayCell(e,t,i){e.firstChild?e.firstChild.innerHTML=t.getContent():e.innerHTML='<div class="DlGrid-cellData">'+t.getContent()+"</div>",e.className="DlGrid-align-"+t.getStyle("textAlign",i.getStyle("textAlign","left"))}eval(Dynarch.EXPORT("DlGridRow",!0)),D.DEFAULT_ARGS={_tagName:["tagName","tr"],_classes:["classes",{active:"DlGridRow-active",hover:"DlGridRow-hover",checked:"DlGridRow-1",unchecked:"DlGridRow-0",empty:"DlGridRow-empty",disabled:"DlGridRow-disabled"}],_btnType:["type",DlButton.TYPE.TWOSTATE],_model:["model",null],_focusable:["focusable",!0],__tooltip:["tooltip",getTooltip]},P.getModel=function(){return this._model},P._onClick=function(e){this.parent.getGroup().maxChecked(e.ctrlKey&&"multiple"==this.parent._selType?null:1),BASE._onClick.call(this,e)},P._handle_focusKeys=function(e){var t=this.parent,i=t.getGroup();if(e.keyCode!=DlKeyboard.ENTER)return BASE._handle_focusKeys.call(this,e);i.maxChecked(e.shiftKey||e.ctrlKey&&"multiple"==t._selType?null:1),this.applyHooks("onClick",[e]),e.domStop=!0},P._createElement=function(){DlWidget.prototype._createElement.call(this);var i=this.getElement();this._model.foreachCell(function(e,t){displayCell(CE("td",null,null,i),e,t)},this),this._on_modelChange=this._on_modelChange.$(this),this._model.addEventListener("onChange",this._on_modelChange),this.addEventListener("onDestroy",onDestroy)},P._on_modelChange=function(e,t,i,l){"value"===i&&displayCell(this.getElement().cells[t.getIndex()],t,this._model.model.getColByIndex(t.getIndex()))}}(),!function(){var BASE=DlGridHeadLabel.inherits(DlButton);function DlGridHeadLabel(e){e&&(this.column=e.column,e.focusable=!1,this.__withIconClass="DlButton-withIcon",DlButton.call(this,e),this.column.isSortable||(this.__disabled=!0))}eval(Dynarch.EXPORT("DlGridHeadLabel")),P.setWidth=function(e){this.setOuterSize({x:e})},P.label=function(e){this.setContent("<div class='DlButton-Label'>"+this._label+"</div>")},P._onClick=function(){this.column.sort()},D.DEFAULT_ARGS={_classes:["classes",{active:"DlGridHeadLabel-active",hover:"DlGridHeadLabel-hover",checked:"DlGridHeadLabel-1",unchecked:"DlGridHeadLabel-0",empty:"DlGridHeadLabel-empty",disabled:"DlGridHeadLabel-disabled"}]}}();